<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>상원씨 괴롭힐 방법 고민중</title>
<style>
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0; padding: 0;
    font-family: Arial, sans-serif;
    background: #f0f0f0;
  }

  .slider-container {
    width: 600px;
    margin: 40px auto;
    background: white;
    border: 1px solid #ccc;
    overflow: hidden;
    user-select: none;
    position: relative;
  }

  /* 상위 페이지 버튼 영역 */
  .top-buttons {
    display: flex;
    justify-content: center;
    gap: 10px;
    padding: 10px 0;
    background: #222;
  }

  .top-button {
    width: 60px;
    height: 30px;
    background-color: #007bff;
    border-radius: 4px;
    opacity: 0.4;
    color: white;
    font-weight: bold;
    font-size: 18px;
    line-height: 30px;
    text-align: center;
    user-select: none;
    cursor: default;
    transition: opacity 0.3s ease;
  }
  .top-button.active {
    opacity: 1;
  }

  /* 상위 페이지 슬라이드 영역 */
  .top-slider {
    position: relative;
    width: 100%;
    height: 350px;
    overflow: hidden;
  }

  .top-slide {
    display: flex;
    width: 300%; /* 3상위페이지 */
    height: 100%;
    transition: transform 0.3s ease;
  }

  /* 각 상위페이지(하위페이지 2개 포함) */
  .top-page {
    width: 33.3333%;
    height: 100%;
    overflow: hidden;
    position: relative;
  }

  /* 하위 페이지 슬라이더 */
  .sub-slider {
    position: relative;
    width: 100%;
    height: 100%;
    overflow: hidden;
  }

  .sub-slide {
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0; left: 0;
    opacity: 0;
    transition: opacity 0.6s ease;
  }
  .sub-slide.active {
    opacity: 1;
    position: relative;
  }

  /* 하위 페이지 이미지 */
  .sub-slide img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  /* 하위 페이지 슬라이드 위치 점 */
  .dots-container {
    position: absolute;
    bottom: 12px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 6px;
  }
  .dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: rgba(255,255,255,0.6);
    cursor: default;
    transition: background 0.3s ease;
  }
  .dot.active {
    background: rgba(255,255,255,1);
  }
</style>
</head>
<body>

<div class="slider-container">

  <!-- 상위 페이지 버튼 -->
  <div class="top-buttons">
    <div class="top-button active" data-index="0">A</div>
    <div class="top-button" data-index="1">B</div>
    <div class="top-button" data-index="2">C</div>
  </div>

  <!-- 상위 페이지 슬라이드 -->
  <div class="top-slider" id="topSlider">
    <div class="top-slide" id="topSlide">
      <!-- 상위페이지 A -->
      <div class="top-page" data-top-index="0">
        <div class="sub-slider" data-sub-index="0">
          <div class="sub-slide active">
            <img src="https://picsum.photos/id/1015/600/350" alt="A-1" />
          </div>
          <div class="sub-slide">
            <img src="https://picsum.photos/id/1016/600/350" alt="A-2" />
          </div>
          <div class="dots-container">
            <div class="dot active"></div>
            <div class="dot"></div>
          </div>
        </div>
      </div>

      <!-- 상위페이지 B -->
      <div class="top-page" data-top-index="1">
        <div class="sub-slider" data-sub-index="1">
          <div class="sub-slide active">
            <img src="https://picsum.photos/id/1025/600/350" alt="B-1" />
          </div>
          <div class="sub-slide">
            <img src="https://picsum.photos/id/1026/600/350" alt="B-2" />
          </div>
          <div class="dots-container">
            <div class="dot active"></div>
            <div class="dot"></div>
          </div>
        </div>
      </div>

      <!-- 상위페이지 C -->
      <div class="top-page" data-top-index="2">
        <div class="sub-slider" data-sub-index="2">
          <div class="sub-slide active">
            <img src="https://picsum.photos/id/1035/600/350" alt="C-1" />
          </div>
          <div class="sub-slide">
            <img src="https://picsum.photos/id/1036/600/350" alt="C-2" />
          </div>
          <div class="dots-container">
            <div class="dot active"></div>
            <div class="dot"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>

<script>
  (function(){
    const topSlide = document.getElementById('topSlide');
    const topButtons = document.querySelectorAll('.top-button');
    const topSlider = document.getElementById('topSlider');

    let topIndex = 0;  // 현재 상위 페이지 인덱스 (0,1,2)
    let startX = 0;
    let currentTranslate = 0;
    let isDragging = false;

    // 하위페이지 자동 슬라이드 관련
    const subSliders = document.querySelectorAll('.sub-slider');
    const subIntervalTime = 4000; // 4초마다 슬라이드 전환
    let subTimers = [];

    // 하위페이지 자동 슬라이드 함수 초기화
    function initSubSliders(){
      subSliders.forEach((subSlider, idx) => {
        let subIndex = 0;
        const slides = subSlider.querySelectorAll('.sub-slide');
        const dots = subSlider.querySelectorAll('.dot');

        function showSubSlide(i){
          slides.forEach((slide, si) => {
            if(si === i){
              slide.classList.add('active');
              dots[si].classList.add('active');
            } else {
              slide.classList.remove('active');
              dots[si].classList.remove('active');
            }
          });
        }

        function nextSubSlide(){
          subIndex = (subIndex +1) % slides.length;
          showSubSlide(subIndex);
        }

        showSubSlide(subIndex);

        if(subTimers[idx]) clearInterval(subTimers[idx]);
        subTimers[idx] = setInterval(nextSubSlide, subIntervalTime);
      });
    }

    // 상위페이지 이동 함수 (translateX)
    function moveTopSlide(index){
      currentTranslate = -index * 100/3; // 100% / 3 상위페이지수 = 33.3333%
      topSlide.style.transform = `translateX(${currentTranslate}%)`;
      topIndex = index;

      // 상위 버튼 투명도 표시
      topButtons.forEach((btn, i) => {
        if(i === topIndex){
          btn.classList.add('active');
        } else {
          btn.classList.remove('active');
        }
      });
    }

    // 터치/마우스 이벤트 처리 : 상위페이지 스와이프 이동
    function touchStart(e){
      isDragging = true;
      startX = e.type.includes('mouse') ? e.pageX : e.touches[0].clientX;
    }
    function touchMove(e){
      if(!isDragging) return;
      const currentX = e.type.includes('mouse') ? e.pageX : e.touches[0].clientX;
      const diff = currentX - startX;

      // 제한 범위 안에서만 슬라이드 이동
      // 여기서는 스와이프 중 실제 transform 값은 바꾸지 않고 종료 후에만 이동처리
      e.preventDefault();
    }
    function touchEnd(e){
      if(!isDragging) return;
      isDragging = false;
      const endX = e.type.includes('mouse') ? e.pageX : e.changedTouches[0].clientX;
      const diff = endX - startX;

      if(Math.abs(diff) > 50){
        if(diff < 0 && topIndex < 2){
          moveTopSlide(topIndex +1);
        } else if(diff > 0 && topIndex > 0){
          moveTopSlide(topIndex -1);
        }
      }
    }

    // 초기 셋업
    moveTopSlide(0);
    initSubSliders();

    // 이벤트 리스너 등록
    topSlider.addEventListener('touchstart', touchStart);
    topSlider.addEventListener('touchmove', touchMove, { passive:false });
    topSlider.addEventListener('touchend', touchEnd);

    topSlider.addEventListener('mousedown', touchStart);
    topSlider.addEventListener('mousemove', touchMove);
    topSlider.addEventListener('mouseup', touchEnd);
    topSlider.addEventListener('mouseleave', touchEnd);

  })();
</script>

</body>
</html>
