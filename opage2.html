<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>슬라이드 배너</title>
<style>
  * {
    box-sizing: border-box;
  }
  body {
    margin:0; padding:0;
    font-family: Arial, sans-serif;
  }
  .banner-container {
    width: 600px;
    margin: 20px auto;
    user-select: none;
    position: relative;
  }

  /* 상위 페이지 버튼 (상태 표시용) */
  .top-buttons {
    display: flex;
    justify-content: center;
    margin-bottom: 10px;
  }
  .top-button {
    width: 40px; height: 40px;
    margin: 0 8px;
    background-color: #007bff;
    border-radius: 50%;
    opacity: 0.4;
    cursor: default;
    transition: opacity 0.3s ease;
  }
  .top-button.active {
    opacity: 1;
  }

  /* 상위 페이지 영역 */
  .top-pages-wrapper {
    position: relative;
    overflow: hidden;
    width: 100%;
    height: 350px;
    touch-action: pan-y; /* 수직 스크롤 허용 */
  }
  .top-page {
    position: absolute;
    top:0; left:0;
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: transform 0.5s ease;
    will-change: transform;
  }
  /* 상위 페이지 기본는 화면 밖으로 배치 */
  .top-page.inactive-left {
    transform: translateX(-100%);
  }
  .top-page.inactive-right {
    transform: translateX(100%);
  }
  .top-page.active {
    transform: translateX(0);
  }

  /* 하위 페이지 래퍼 */
  .sub-pages-wrapper {
    position: relative;
    width: 90%;
    height: 280px;
    overflow: hidden;
  }
  /* 하위 페이지 */
  .sub-page {
    position: absolute;
    top:0; left:0;
    width: 100%;
    height: 100%;
    opacity: 0;
    transition: opacity 0.7s ease;
  }
  .sub-page.active {
    opacity: 1;
    z-index: 2;
  }

  /* 하위 페이지 점 표시 */
  .sub-indicators {
    position: absolute;
    bottom: 15px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 8px;
    z-index: 10;
  }
  .sub-indicators .dot {
    width: 12px; height: 12px;
    border-radius: 50%;
    background-color: #bbb;
    opacity: 0.5;
    transition: opacity 0.3s ease, background-color 0.3s ease;
  }
  .sub-indicators .dot.active {
    background-color: #444;
    opacity: 1;
  }
</style>
</head>
<body>

<div class="banner-container">
  <!-- 상위 페이지 상태 표시 버튼 -->
  <div class="top-buttons">
    <div class="top-button active" data-index="0" title="A"></div>
    <div class="top-button" data-index="1" title="B"></div>
    <div class="top-button" data-index="2" title="C"></div>
  </div>

  <!-- 상위 페이지 래퍼 -->
  <div class="top-pages-wrapper" id="topPagesWrapper">
    <!-- A 상위 페이지 -->
    <div class="top-page active" data-index="0">
      <div class="sub-pages-wrapper">
        <img src="https://picsum.photos/id/1015/540/280" alt="A-1" class="sub-page active" />
        <img src="https://picsum.photos/id/1016/540/280" alt="A-2" class="sub-page" />
        <div class="sub-indicators">
          <span class="dot active"></span>
          <span class="dot"></span>
        </div>
      </div>
    </div>

    <!-- B 상위 페이지 -->
    <div class="top-page inactive-right" data-index="1">
      <div class="sub-pages-wrapper">
        <img src="https://picsum.photos/id/1018/540/280" alt="B-1" class="sub-page active" />
        <img src="https://picsum.photos/id/1019/540/280" alt="B-2" class="sub-page" />
        <div class="sub-indicators">
          <span class="dot active"></span>
          <span class="dot"></span>
        </div>
      </div>
    </div>

    <!-- C 상위 페이지 -->
    <div class="top-page inactive-right" data-index="2">
      <div class="sub-pages-wrapper">
        <img src="https://picsum.photos/id/1021/540/280" alt="C-1" class="sub-page active" />
        <img src="https://picsum.photos/id/1022/540/280" alt="C-2" class="sub-page" />
        <div class="sub-indicators">
          <span class="dot active"></span>
          <span class="dot"></span>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
(() => {
  const topPagesWrapper = document.getElementById('topPagesWrapper');
  const topPages = topPagesWrapper.querySelectorAll('.top-page');
  const topButtons = document.querySelectorAll('.top-button');

  let currentTopIndex = 0;
  let currentSubIndex = 0;
  let subSlideInterval = null;

  // 현재 하위 페이지 점 업데이트
  function updateSubIndicators() {
    const currentTopPage = topPages[currentTopIndex];
    const dots = currentTopPage.querySelectorAll('.sub-indicators .dot');
    dots.forEach((dot, idx) => {
      dot.classList.toggle('active', idx === currentSubIndex);
    });
  }

  // 하위 페이지 자동 슬라이드 시작
  function startSubSlide() {
    stopSubSlide();
    subSlideInterval = setInterval(() => {
      const currentTopPage = topPages[currentTopIndex];
      const subPages = currentTopPage.querySelectorAll('.sub-page');

      subPages[currentSubIndex].classList.remove('active');
      currentSubIndex = (currentSubIndex + 1) % subPages.length;
      subPages[currentSubIndex].classList.add('active');

      updateSubIndicators();
    }, 3000);
  }

  // 하위 페이지 자동 슬라이드 멈춤
  function stopSubSlide() {
    if(subSlideInterval) {
      clearInterval(subSlideInterval);
      subSlideInterval = null;
    }
  }

  // 상위 페이지 상태 표시 업데이트 (버튼 투명도)
  function updateTopButtons() {
    topButtons.forEach((btn, idx) => {
      btn.classList.toggle('active', idx === currentTopIndex);
    });
  }

  // 상위 페이지 스와이프 제어
  let startX = 0;
  let isDragging = false;

  topPagesWrapper.addEventListener('touchstart', e => {
    if(e.touches.length !== 1) return;
    startX = e.touches[0].clientX;
    isDragging = true;
    stopSubSlide();
  });

  topPagesWrapper.addEventListener('touchmove', e => {
    if(!isDragging) return;
    const moveX = e.touches[0].clientX;
    const diffX = moveX - startX;

    // 여기선 드래그 시 애니메이션은 빼고 터치 이동 방향만 체크
  });

  topPagesWrapper.addEventListener('touchend', e => {
    if(!isDragging) return;
    isDragging = false;
    const endX = e.changedTouches[0].clientX;
    const diffX = endX - startX;

    if(Math.abs(diffX) > 50) {
      if(diffX < 0 && currentTopIndex < topPages.length - 1) {
        // 왼쪽으로 스와이프 → 다음 상위 페이지
        moveToTopPage(currentTopIndex + 1);
      } else if(diffX > 0 && currentTopIndex > 0) {
        // 오른쪽으로 스와이프 → 이전 상위 페이지
        moveToTopPage(currentTopIndex - 1);
      }
    }
    startSubSlide();
  });

  // 상위 페이지 이동 처리
  function moveToTopPage(newIndex) {
    if(newIndex === currentTopIndex) return;

    // 현재 top page를 좌측 또는 우측으로 밀어내고
    if(newIndex > currentTopIndex) {
      topPages[currentTopIndex].classList.remove('active');
      topPages[currentTopIndex].classList.add('inactive-left');

      topPages[newIndex].classList.remove('inactive-right');
      topPages[newIndex].classList.add('active');
    } else {
      topPages[currentTopIndex].classList.remove('active');
      topPages[currentTopIndex].classList.add('inactive-right');

      topPages[newIndex].classList.remove('inactive-left');
      topPages[newIndex].classList.add('active');
    }

    currentTopIndex = newIndex;
    currentSubIndex = 0; // 하위 페이지 초기화
    updateTopButtons();
    updateSubIndicators();
  }

  // 초기 시작
  updateTopButtons();
  updateSubIndicators();
  startSubSlide();
})();
</script>

</body>
</html>
