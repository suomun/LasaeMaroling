<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>상위-하위 슬라이드 배너</title>
<style>
  body {
    margin: 0; font-family: Arial, sans-serif;
    background: #111; color: #fff;
    overflow-x: hidden;
  }
  /* 상위 페이지 버튼 */
  .top-buttons {
    display: flex;
    justify-content: center;
    margin: 20px 0;
    gap: 20px;
    user-select: none;
  }
  .top-buttons button {
    padding: 10px 28px;
    font-size: 18px;
    background: #444;
    border: none;
    border-radius: 6px;
    color: #bbb;
    cursor: pointer;
    box-shadow: 0 0 5px transparent;
    transition: box-shadow 0.3s ease, color 0.3s ease;
  }
  .top-buttons button.active {
    color: #0ff;
    box-shadow: 0 0 15px #0ff;
  }

  /* 배너 컨테이너 */
  .banner-container {
    position: relative;
    max-width: 900px;
    height: 400px;
    margin: 0 auto 40px auto;
    overflow: hidden;
    user-select: none;
    background: #222;
    border-radius: 12px;
  }

  /* 상위 페이지 래퍼 (가로배치) */
  .top-pages-wrapper {
    display: flex;
    height: 100%;
    width: 300%; /* 3개 상위 페이지 */
    transition: transform 0.4s ease;
    touch-action: pan-y;
  }

  /* 개별 상위 페이지 */
  .top-page {
    position: relative;
    width: 33.3333%;
    height: 100%;
    padding: 20px;
    box-sizing: border-box;
  }

  /* 하위 페이지 컨테이너 */
  .sub-pages {
    position: relative;
    height: 100%;
    border-radius: 8px;
    overflow: hidden;
    background: #333;
  }

  /* 하위 페이지 (이미지) */
  .sub-page {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    opacity: 0;
    transition: opacity 0.8s ease;
    z-index: 1;
  }
  .sub-page.active {
    opacity: 1;
    z-index: 2;
  }
  .sub-page img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 8px;
    user-select: none;
    pointer-events: none;
  }
</style>
</head>
<body>

<!-- 상위 페이지 선택 버튼 -->
<div class="top-buttons">
  <button data-index="0" class="active">A</button>
  <button data-index="1">B</button>
  <button data-index="2">C</button>
</div>

<!-- 배너 전체 -->
<div class="banner-container" id="banner">

  <!-- 상위 페이지 전체 래퍼 -->
  <div class="top-pages-wrapper" id="topPagesWrapper">

    <!-- 상위 페이지 A -->
    <div class="top-page">
      <div class="sub-pages">
        <div class="sub-page active"><img src="https://picsum.photos/id/1015/900/400" alt="A-1"></div>
        <div class="sub-page"><img src="https://picsum.photos/id/1016/900/400" alt="A-2"></div>
      </div>
    </div>

    <!-- 상위 페이지 B -->
    <div class="top-page">
      <div class="sub-pages">
        <div class="sub-page active"><img src="https://picsum.photos/id/1020/900/400" alt="B-1"></div>
        <div class="sub-page"><img src="https://picsum.photos/id/1021/900/400" alt="B-2"></div>
      </div>
    </div>

    <!-- 상위 페이지 C -->
    <div class="top-page">
      <div class="sub-pages">
        <div class="sub-page active"><img src="https://picsum.photos/id/1025/900/400" alt="C-1"></div>
        <div class="sub-page"><img src="https://picsum.photos/id/1026/900/400" alt="C-2"></div>
      </div>
    </div>

  </div>
</div>

<script>
(() => {
  const topButtons = document.querySelectorAll('.top-buttons button');
  const topPagesWrapper = document.getElementById('topPagesWrapper');
  const banner = document.getElementById('banner');

  const topPageCount = 3;   // A, B, C
  const subPageCount = 2;   // 각 상위 페이지별 하위 페이지 수
  let currentTopIndex = 0;  // 현재 상위 페이지 인덱스 (0~2)
  let currentSubIndex = 0;  // 현재 하위 페이지 인덱스 (0~1)
  let subSlideTimer = null;

  // 하위 페이지들(각 상위 페이지별로)
  const subPagesList = [];
  for(let i=0; i<topPageCount; i++) {
    const topPage = topPagesWrapper.children[i];
    const subPages = topPage.querySelectorAll('.sub-page');
    subPagesList.push(subPages);
  }

  // 상위 페이지 위치 이동 함수
  function moveToTopPage(index) {
    if(index < 0 || index >= topPageCount) return;
    currentTopIndex = index;
    // transform 이동 (가로 슬라이드)
    topPagesWrapper.style.transform = `translateX(-${(100/3)*index}%)`;
    updateTopButtons();
    resetSubPages();
  }

  // 상위 페이지 버튼 상태 업데이트 (활성화 표시)
  function updateTopButtons() {
    topButtons.forEach((btn,i) => {
      btn.classList.toggle('active', i === currentTopIndex);
    });
  }

  // 하위 페이지 초기화 (첫 번째 하위 페이지 활성화, 타이머 재시작)
  function resetSubPages() {
    currentSubIndex = 0;
    // 모든 하위 페이지 숨기기, 첫번째만 활성화
    subPagesList.forEach((subPages, i) => {
      subPages.forEach(sp => sp.classList.remove('active'));
    });
    subPagesList[currentTopIndex][currentSubIndex].classList.add('active');
    restartSubSlideTimer();
  }

  // 하위 페이지 자동 슬라이드 함수 (페이드 효과)
  function nextSubPage() {
    const subPages = subPagesList[currentTopIndex];
    subPages[currentSubIndex].classList.remove('active');
    currentSubIndex = (currentSubIndex + 1) % subPages.length;
    subPages[currentSubIndex].classList.add('active');
  }

  // 자동 슬라이드 타이머 시작/재시작
  function restartSubSlideTimer() {
    if(subSlideTimer) clearInterval(subSlideTimer);
    subSlideTimer = setInterval(() => {
      nextSubPage();
    }, 3000);
  }

  // 상위 페이지 버튼 클릭 이벤트
  topButtons.forEach((btn, idx) => {
    btn.addEventListener('click', () => {
      moveToTopPage(idx);
    });
  });

  // 스와이프(터치, 마우스 드래그) 이벤트 처리
  let startX = 0;
  let currentTranslateX = 0;
  let isDragging = false;

  function clamp(value, min, max) {
    return Math.min(Math.max(value, min), max);
  }

  banner.addEventListener('touchstart', (e) => {
    if(e.touches.length !== 1) return;
    isDragging = true;
    startX = e.touches[0].clientX;
    currentTranslateX = - (100 / 3) * currentTopIndex;
    topPagesWrapper.style.transition = 'none';
    if(subSlideTimer) clearInterval(subSlideTimer);
  });

  banner.addEventListener('touchmove', (e) => {
    if(!isDragging) return;
    const moveX = e.touches[0].clientX;
    const deltaX = moveX - startX;
    // 화면 너비 대비 퍼센트 계산
    const bannerWidth = banner.clientWidth;
    let movePercent = (deltaX / bannerWidth) * 100;
    let nextTranslate = currentTranslateX + (movePercent / 3); // 3 페이지 분할
    nextTranslate = clamp(nextTranslate, -66.6666, 0);
    topPagesWrapper.style.transform = `translateX(${nextTranslate}%)`;
  });

  banner.addEventListener('touchend', (e) => {
    if(!isDragging) return;
    isDragging = false;
    topPagesWrapper.style.transition = 'transform 0.4s ease';
    const bannerWidth = banner.clientWidth;
    const endX = e.changedTouches[0].clientX;
    const deltaX = endX - startX;
    // 스와이프 기준: 30px 이상 움직이면 페이지 전환
    if(deltaX < -30 && currentTopIndex < topPageCount - 1) {
      moveToTopPage(currentTopIndex + 1);
    } else if(deltaX > 30 && currentTopIndex > 0) {
      moveToTopPage(currentTopIndex - 1);
    } else {
      // 원위치 복귀
      moveToTopPage(currentTopIndex);
    }
  });

  // PC 마우스 드래그 이벤트 지원
  banner.addEventListener('mousedown', (e) => {
    isDragging = true;
    startX = e.clientX;
    currentTranslateX = - (100 / 3) * currentTopIndex;
    topPagesWrapper.style.transition = 'none';
    if(subSlideTimer) clearInterval(subSlideTimer);
    e.preventDefault();
  });
  banner.addEventListener('mousemove', (e) => {
    if(!isDragging) return;
    const deltaX = e.clientX - startX;
    const bannerWidth = banner.clientWidth;
    let movePercent = (deltaX / bannerWidth) * 100;
    let nextTranslate = currentTranslateX + (movePercent / 3);
    nextTranslate = clamp(nextTranslate, -66.6666, 0);
    topPagesWrapper.style.transform = `translateX(${nextTranslate}%)`;
  });
  banner.addEventListener('mouseup', (e) => {
    if(!isDragging) return;
    isDragging = false;
    topPagesWrapper.style.transition = 'transform 0.4s ease';
    const deltaX = e.clientX - startX;
    if(deltaX < -30 && currentTopIndex < topPageCount - 1) {
      moveToTopPage(currentTopIndex + 1);
    } else if(deltaX > 30 && currentTopIndex > 0) {
      moveToTopPage(currentTopIndex - 1);
    } else {
      moveToTopPage(currentTopIndex);
    }
  });
  banner.addEventListener('mouseleave', (e) => {
    if(isDragging) {
      isDragging = false;
      topPagesWrapper.style.transition = 'transform 0.4s ease';
      moveToTopPage(currentTopIndex);
    }
  });

  // 초기 세팅
  moveToTopPage(0);
})();
</script>

</body>
</html>
